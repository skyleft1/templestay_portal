<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mapperboard">
           
    <!-- ModelBoard -->
    
    <insert id="insertBoard" parameterType="ModelBoard">
        INSERT INTO 
        TB_BOARD ( boardcd, boardname )
        VALUES       ( #{boardcd}, #{boardname})
    </insert>
    
    <insert id="insertBoardList" parameterType="java.util.List">
        INSERT INTO TB_Bbs_Board( boardcd , boardname )
        VALUES
            <foreach collection="list" item="item" index="index" open="(" separator="),(" close=")">
                #{item.boardcd} , #{item.boardname}
            </foreach>
    </insert>
 
    <select id="getBoardOne" parameterType="string" resultType="ModelBoard">
        SELECT boardcd
        , boardname
          FROM TB_BOARD 
         WHERE boardcd = #{boardcd}
    </select>
    
    <select id="getBoardList" parameterType="ModelBoard">        
        SELECT *
          FROM TB_BOARD
    </select>
    
    <update id="updateBoard" parameterType="hashmap">
        UPDATE TB_BOARD 
            SET boardcd   = #{updateValue.boardcd}
              , boardname     = #{updateValue.boardname}
            WHERE 1 = 1 
              <if test="searchValue.boardcd != null and searchValue.boardcd != ''" >
              AND boardcd    = #{searchValue.boardcd}
              </if>
              <if test="searchValue.boardname != null and searchValue.boardname != ''">
              AND boardname  = #{searchValue.boardname}
              </if>
    </update>
    
    <delete id="deleteBoard" parameterType="ModelBoard">
        DELETE FROM TB_BOARD 
          WHERE 1 = 1 
          <if test="boardcd != null and boardcd != ''" >
          AND boardcd  = #{boardcd}
          </if>
          <if test="boardname != null and boardname != ''">
          AND boardnm  = #{boardname}
          </if>
    </delete>
    
    <select id="getBoardSearch" parameterType="ModelBoard" resultType="ModelBoard">
        SELECT boardcd, boardname
          FROM TB_BOARD
           WHERE 1 =1 
           <if  test="boardcd != null and boardcd != ''">
           AND boardcd LIKE CONCAT( '%' , #{boardcd} ,  '%' )
           </if>
           <if  test="boardname != null and boardname != ''">
           AND boardname LIKE CONCAT( '%' , #{boardname} , '%' )
           </if>
    </select>
    
    
    
    
 
     
    <!--ModelBoard_Article -->
    
    <insert id="insertBoard_Article" parameterType="ModelBoard_Article">
        INSERT INTO 
        TB_BOARD_ARTICLE ( userid, boardcd, title, content, hit, nowdate )
        VALUES       ( #{userid}, #{boardcd}, #{title}, #{content}, 0, #{nowdate})
    </insert>
    
    <select id="getBoard_Article" parameterType="int" resultType="ModelBoard_Article">
        SELECT articleno, userid, boardcd, title, content, hit, nowdate
        FROM TB_BOARD_ARTICLE
        WHERE articleno = #{articleno}
    </select>
 
    <select id="getBoard_ArticleList" parameterType="ModelBoard_Article">        
        SELECT articleno, userid, boardcd, title, content, hit, nowdate
          FROM (
            SELECT @RNUM := @RNUM + 1 AS r, a.* 
            FROM (
                    SELECT a.articleno articleno, 
                           count(distinct(u.userid)) userid, 
                           count(distinct(o.boardcd)) boardcd,
                           a.title, 
                           a.content,                            
                           a.hit, 
                           a.nowdate                   
                    FROM 
                        TB_BOARD_ARTICLE a
                        LEFT OUTER JOIN TB_BOARD_ARTICLE_ATTACHFILE f ON a.articleno = f.articleno
                        LEFT OUTER JOIN TB_BOARD_ARTICLE_COMMENT    c ON a.articleno = c.articleno
                        LEFT OUTER JOIN TB_USER                     u ON a.userid    = u.userid
                        LEFT OUTER JOIN TB_BOARD                    o ON a.boardcd   = o.boardcd
                    WHERE
                        a.boardcd = #{boardcd}
                        <if test="searchWord != null">
                        AND (title LIKE '%${searchWord}%' OR content LIKE '%${searchWord}%')
                        </if>
                    GROUP BY a.articleno, title, content, hit, nowdate
                    ORDER BY articleno DESC
                 ) a, (SELECT @RNUM:=0) b
            ) temp
        WHERE r BETWEEN #{start} AND #{end}
    </select>
    
    <update id="updateBoard_ArticleList" parameterType="hashmap">
        UPDATE TB_BOARD_ARTICLE 
           SET title     = #{updateValue.title}
             , content   = #{updateValue.content}              
             , nowdate   = #{updateValue.nowdate , jdbcType=DATE}
         WHERE  1 = 1 
              <if test="searchValue.boardcd != null and searchValue.boardcd != ''" >
              AND boardcd    = #{searchValue.boardcd}
              </if>
              <if test="searchValue.articleno != null and searchValue.articleno != ''">
              AND articleno  = #{searchValue.articleno}
              </if>
              <if test="searchValue.title != null and searchValue.userid != ''">
              AND userid      = #{searchValue.userid}
              </if>
              <if test="searchValue.title != null and searchValue.title != ''">
              AND title      = #{searchValue.title}
              </if>
              <if test="searchValue.title != null and searchValue.content != ''">
              AND content      = #{searchValue.content}
              </if>                            
    </update>
    
    <delete id="deleteBoard_ArticleList" parameterType="ModelBoard_Article">
        DELETE FROM TB_BOARD_ARTICLE 
         WHERE 1 = 1 
          <if test="articleno != null and articleno != ''" >
          AND articleno = #{articleno}
          </if>
          <if test="boardcd != null and boardcd != ''">
          AND boardcd  = #{boardcd}
          </if>         
    </delete>
    
    <update id="increaseHit" parameterType="int">
        UPDATE TB_BOARD_ARTICLE 
           SET hit = hit + 1 
         WHERE articleno = #{articleno}
    </update>
    
    
    
    
    
    
    <!--ModelBoard_Article_Attachfile -->
    
    <insert id="insertBoard_Article_Attachfile" parameterType="ModelBoard_Article_Attachfile">
        INSERT INTO 
        TB_BOARD_ARTICLE_ATTACHFILE ( articleno, filename, filetype, filesize, tempfilename )
        VALUES       ( #{articleno}, #{filename}, #{filetype}, #{filesize}, #{tempfilename}})
    </insert> 

    <select id="getBoard_Article_Attachfile" parameterType="int" resultType="ModelBoard_Article_Attachfile">        
        SELECT attachfileno, articleno, filename, filetype, filesize, tempfilename
          FROM TB_BOARD_ARTICLE_ATTACHFILE
          WHERE attachfileno = #{attachfileno}              
    </select>
    
    <select id="getBoard_Article_AttachfileList" parameterType="ModelBoard_Article_Attachfile" resultType="ModelBoard_Article_Attachfile">        
        SELECT attachfileno, articleno, filename, filetype, filesize, tempfilename
          FROM TB_BOARD_ARTICLE_ATTACHFILE
          WHERE articleno = #{articleno} 
          ORDER BY attachfileno DESC
    </select> 
    
    <delete id="deleteBoard_Article_AttachfileList" parameterType="ModelBoard_Article_Attachfile">
        DELETE FROM TB_BOARD_ARTICLE_ATTACHFILE          
         WHERE 1 = 1 
          <if test="attachfileno != null and attachfileno != ''" >
          AND attachfileno = #{attachfileno}
          </if>
          <if test="articleno != null and articleno != ''">
          AND articleno  = #{articleno}
          </if>          
    </delete>
    
    
    
    
    
    
    <!--ModelBoard_Article_Comment -->
    
    <insert id="insertBoard_Article_Comment" parameterType="ModelBoard_Article_Comment">
        INSERT INTO 
        TB_BOARD_ARTICLE_COMMENT ( articleno, commentmemo, nowdate, userid )
        VALUES       ( #{articleno}, #{commentmemo}, #{nowdate}, #{userid} )
    </insert>    

    <select id="getBoard_Article_Comment" parameterType="int" resultType="ModelBoard_Article_Comment">        
        SELECT commentno, articleno, commentmemo, nowdate, userid
          FROM TB_BOARD_ARTICLE_COMMENT          
          WHERE commentno = #{commentno}
    </select>
    
    <select id="getBoard_Article_CommentList" parameterType="ModelBoard_Article_Comment">        
        SELECT commentno, articleno, commentmemo, nowdate, userid
          FROM TB_BOARD_ARTICLE_COMMENT
          WHERE articleno = #{articleno}
          ORDER BY commentno DESC
    </select>
    
    <update id="updateBoard_Article_Comment" parameterType="hashmap">
        UPDATE TB_BOARD_ARTICLE_COMMENT 
           SET commentmemo      = #{updateValue.memo   }                 
             , nowdate   = #{updateValue.nowdate , jdbcType=DATE}         
         WHERE  1 = 1 
              <if test="searchValue.commentno != null and searchValue.commentno != ''" >
              AND commentno = #{searchValue.commentno}
              </if>
              <if test="searchValue.articleno != null and searchValue.articleno != ''">
              AND articleno = #{searchValue.articleno}
              </if>              
    </update>
    
    <delete id="deleteBoard_Article_Comment" parameterType="ModelBoard_Article_Comment">
        DELETE FROM TB_BOARD_ARTICLE_COMMENT 
        WHERE 1 = 1 
          <if test="commentno != null and commentno != ''" >
          AND commentno = #{commentno}
          </if>
          <if test="articleno != null and articleno != ''">
          AND articleno  = #{articleno}
          </if>          
    </delete>
     
 </mapper>
