<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mappertemple">
           
    <!--  concat으로 주소의 첫부분(ex. 서울) 만 검색해도 나오게 함 -->
    <select id="getTempleOne" parameterType="ModelTemple" resultType="ModelTemple">
        SELECT *
          FROM TB_Temple 
         WHERE 1 = 1
            <if test="templecd != null and templecd != ''" >
            AND templecd = #{templecd}
            </if>
            <if test="templeaddr_road != null and templeaddr_road != ''" >
            AND templeaddr_road LIKE CONCAT( #{templeaddr_road}, '%' )
            </if>
            <if test="templeaddr_jibun != null and templeaddr_jibun != ''" >
            AND templeaddr_jibun LIKE CONCAT( #{templeaddr_jibun}, '%' )
            </if>
    </select>
           
    <select id="getTempleList" parameterType="ModelTemple" resultType="ModelTemple">
        SELECT *
          FROM TB_Temple 
         WHERE 1 = 1
            <if test="templecd != null and templecd != ''" >
            AND templecd = #{templecd}
            </if>
            <if test="templeaddr_road != null and templeaddr_road != ''" >
            AND templeaddr_road LIKE CONCAT( #{templeaddr_road}, '%' )
            </if>
            <if test="templeaddr_jibun != null and templeaddr_jibun != ''" >
            AND templeaddr_jibun LIKE CONCAT( #{templeaddr_jibun}, '%' )
            </if>
    </select>
           
           
    <insert id="insertTempleProgramOne" parameterType="ModelTemple_Program">
        INSERT INTO 
        TB_Temple_Program (programname, availabledate, programprice, maxperson    )
        VALUES       ( #{programname}, #{availabledate}, #{programprice}, #{maxperson} )
    </insert> 


    <select id="getTempleProgramOne" parameterType="ModelTemple_Program" resultType="ModelTemple_Program">
        SELECT *
          FROM TB_Temple_Program 
         WHERE 1 = 1
         <if test="programno != null and programno != ''">
         AND programno = #{programno}
         </if>
         <if test="programname != null and programname != ''">
         AND programname = #{programname}
         </if> 
    </select>
    
    <update id="updateTempleProgram" parameterType="hashmap" >
        UPDATE TB_Temple_Program 
            SET programname   = #{updateValue.programname}
              , availabledate = #{updateValue.availabledate}
              , programprice  = #{updateValue.programprice}
              , maxperson     = #{updateValue.maxperson}
            WHERE 1 = 1 
              <if test="searchValue.programname != null and searchValue.programname != ''" >
              AND programname    = #{searchValue.programname}
              </if>
              <if test="searchValue.programprice != null and searchValue.programprice != ''">
              AND programprice  = #{searchValue.programprice}
              </if>
              <if test="searchValue.maxperson != null">
              AND maxperson    = #{searchValue.maxperson}
              </if>
    </update>
    
    <delete id="deleteTempleProgram" parameterType="ModelTemple_Program">
        DELETE FROM TB_Temple_Program 
         WHERE 1 = 1 
          <if test="programname != null and programname != ''" >
          AND programname  = #{programname}
          </if>
          <if test="programprice != null and programprice != ''">
          AND programprice  = #{programprice}
          </if>
          <if test="maxperson != null">
          AND maxperson    = #{maxperson}
          </if>
    </delete>
    
    
    <!--  left 조인을 이용해서 부모인 temple의 값을 받아옴 -->
    <!--  between 이용해서 가능날짜별로 조회가능하게 함 --> 
    <select id="getTempleProgramList" parameterType="ModelTemple_Program" resultType="ModelTemple_Program" >
        SELECT * 
          FROM TB_Temple_Program C left join TB_Temple P on C.templecd = p.templecd
          WHERE 1 = 1
          <if test="templecd != null and templecd != ''" >
          AND C.templecd  = #{templecd}
          </if>
          <if test="programtype != null and programtype != ''" >
          AND C.programtype  = #{programtype}
          </if>
          <if test="checkdate != null and checkdate != ''" >
          AND #{checkdate} BETWEEN C.availabledate_start AND C.availabledate_end 
          </if>
          <if test="programname != null and programname != ''" >
          AND C.programname  = #{programname}
          </if>
          <if test="programprice != null and programprice != ''" >
          AND C.programprice  = #{programprice}
          </if>
        ORDER BY programno
    </select>
      
 </mapper>
